<link rel="import" href="../polymer/polymer.html" />

<dom-module id="photo-cropper">
	<style>
		:host {
			display: block;
		}
	</style>
  <link rel="stylesheet" href="../cropperjs/dist/cropper.min.css">
	<template>
    <img id="photoPreview" alt="Image to crop"/>
	</template>
  <script src="../cropperjs/dist/cropper.min.js"></script>
	<script>
	Polymer({
		is: 'photo-cropper',
		properties: {
			croppedImage: {
				type: Blob,
				value: null,
        notify: true
			},
      cropWidth: {
        type: Number,
        value: 250
      },
      aspectRatio: {
        type: Number,
        value: 1 //square
      }
		},
		cropper: null,
		ready: function() {
			this.cropper = new Cropper(this.$.photoPreview, {
				aspectRatio: this.aspectRatio,
        viewMode: 2,
        background: true,
        autoCropArea: 1,
        checkCrossOrigin: false,
        crop: function(e) {
          var canvas = this.cropper.getCroppedCanvas({
            width: this.cropWidth,
            height: this.cropWidth * (1/this.aspectRatio)
          });
          canvas.toBlob(function(blob) {
            this.set('croppedImage', blob);
          }.bind(this));
        }.bind(this)
			}); 
		},
    replaceImage: function(src) {
      this.cropper.replace(src);
    }
  });
	</script>
</dom-module>
